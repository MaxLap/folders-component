{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","mobileSource","console","log","data","origin","JSON","parse","handleMessage","document","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","platform","uuid","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this2","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_this3","saveBlock","mappedItems","updated_at","Date","pendingSave","clearTimeout","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","activeUrl","includes","candidate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","theme","deactivateTheme","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","url","link","createElement","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","v","d","getTime","performance","now","Math","random","floor","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","tags","b","title","resolved","rawTags","findResolvedTag","tag","pendingDummy","dummy","unshift","name","comps","split","displayTitle","getParent","depth","parentTitle","join","tagTitle","index","indexOf","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","smartTag","predicate","keypath","operator","createdTag","selectOnLoad","selectTag","multiSelect","isSmartTag","clearMultipleTagsSelection","multipleTags","smartMaster","createEphemeralSmartTagForMultiTags","editing","tagNames","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","setData","classList","add","remove","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event, mobileSource) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data, \"mobile?\", mobileSource);\n        }\n\n        // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        }\n        _this.mobileSource = mobileSource;\n        // If from mobile app, JSON needs to be used.\n        var data = mobileSource ? JSON.parse(event.data) : event.data;\n        _this.handleMessage(data);\n      };\n\n      // Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n      // for postMessage API to work properly.\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event, true);\n      }, false);\n\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event, false);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      // Mobile (React Native) requires a string for the postMessage API.\n      if (this.mobileSource) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n\n        // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this2 = this;\n\n      var mapped = items.map(function (item) {\n        return _this2.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", { items: mapped }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      this.saveItems([item], callback, skipDebouncer);\n    }\n\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n     */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this3 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments[3];\n\n      var saveBlock = function saveBlock() {\n        // presave block allows client to gain the benefit of performing something in the debounce cycle.\n        presave && presave();\n\n        var mappedItems = items.map(function (item) {\n          item.updated_at = new Date();\n          return this.jsonObjectForItem(item);\n        }.bind(_this3));\n\n        _this3.postMessage(\"save-items\", { items: mappedItems }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      } else {\n        saveBlock();\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.activeThemes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var activeUrl = _step2.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = themesToDeactivate[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var theme = _step3.value;\n\n          this.deactivateTheme(theme);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      this.activeThemes = incomingUrls;\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToActivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var url = _step4.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        return element.href == url;\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n\n\n},{}]},{},[1]);\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], () => {\n      // on ready\n      $rootScope.platform = componentManager.platform;\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => (a.content.title > b.content.title) - (a.content.title < b.content.title));\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        // Create smart tag\n        /*\n        ![\"Untagged\", \"tags.length\", \"=\", 0]\n        ![\"B-tags\", \"tags\", \"includes\", [\"title\", \"startsWith\", \"b\"]]\n        ![\"Foo Notes\", \"title\", \"startsWith\", \"Foo\"]\n        ![\"Archived\", \"archived\", \"=\", true]\n        ![\"Pinned\", \"pinned\", \"=\", true]\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentManager.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentManager.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentManager.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : [];\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"contrast\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}