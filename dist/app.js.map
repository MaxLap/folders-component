{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","initialPermissions","loggingEnabled","acceptsThemes","onReadyCallback","coallesedSaving","coallesedSavingDelay","window","addEventListener","event","console","log","data","handleMessage","bind","value","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","uuid","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","setSize","type","width","height","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","map","sendCustomEvent","saveItem","saveItems","_this","updated_at","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","urls","deactivateAllCustomThemes","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","tags","sort","a","b","title","resolved","rawTags","slice","findResolvedTag","tag","pendingDummy","find","dummy","unshift","name","comps","split","displayTitle","parentTitle","join","index","indexOf","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","e","alert","smartTag","predicate","keypath","operator","createdTag","selectOnLoad","selectTag","smartMaster","editing","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","isSmartTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","setData","classList","add","remove","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.initialPermissions = permissions;\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    window.addEventListener(\"message\", function (event) {\n      if (this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.uuid = data.uuid;\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, '*');\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item) {\n      this.deleteItems([item]);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n      this.postMessage(\"delete-items\", params);\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      this.saveItems([item], callback);\n    }\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this = this;\n\n      items = items.map(function (item) {\n        item.updated_at = new Date();\n        return this.jsonObjectForItem(item);\n      }.bind(this));\n\n      var saveBlock = function saveBlock() {\n        _this.postMessage(\"save-items\", { items: items }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(urls) {\n      this.deactivateAllCustomThemes();\n\n      if (this.loggingEnabled) {\n        console.log(\"Activating themes:\", urls);\n      }\n\n      if (!urls) {\n        return;\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = urls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var url = _step2.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"deactivateAllCustomThemes\",\n    value: function deactivateAllCustomThemes() {\n      var elements = document.getElementsByClassName(\"custom-theme\");\n\n      [].forEach.call(elements, function (element) {\n        if (element) {\n          element.disabled = true;\n          element.parentNode.removeChild(element);\n        }\n      });\n    }\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], function(){\n      // on ready\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => (a.content.title > b.content.title) - (a.content.title < b.content.title));\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var parentTitle = comps.slice(0, comps.length - 1).join(delimiter);\n        var parent = findResolvedTag(parentTitle);\n        if(!parent) {\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        // Create smart tag\n        /*\n        ![\"Untagged\", \"tags.length\", \"=\", 0]\n        ![\"B-tags\", \"tags\", \"includes\", [\"title\", \"startsWith\", \"b\"]]\n        ![\"Foo Notes\", \"title\", \"startsWith\", \"Foo\"]\n        ![\"Archived\", \"archived\", \"=\", true]\n        ![\"Pinned\", \"pinned\", \"=\", true]\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag) {\n      if(tag.smartMaster) {\n        // do nothing, but continue to other steps\n      } else if(tag.master) {\n        componentManager.clearSelection();\n      } else {\n        componentManager.selectItem(tag);\n      }\n\n      if($scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      }\n\n      if($scope.selectedTag === tag && !tag.master) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : [];\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function() {\n      $scope.onSelect()($scope.tag);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"default\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        return \"warning\";\n      }\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\"\n      }[gen];\n\n      return circleClass ? circleClass : \"default\";\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}